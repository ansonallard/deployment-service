# Deployment Service

Service to manage the CI/CD of ansonallard.com self hosted services.

## Start Service

1. Copy `.env.sample` to `.env`
2. Fill out all required values
3. Run `go build .`
4. Execute the binary file, `./deployment-service`

### Update service version

1. Commit all changes
2. Run `update_service_version.sh -v <semverVersion>`

---

## Running in Production

### Linux Firewall rules

Ensure that the linux host running the binary allows traffic from external hosts on the port.

Check this using:

```
sudo ufw status verbose
```

Add firewall rule using:

```
sudo ufw allow <port>>/tcp
sudo ufw reload
```

### Docker Configuration

See instructions for communicating with Gitea here: https://github.com/ansonallard/gitea_config

### Pulling Autogenerated Typescript Clients

Configure your ~/.npmrc with the following:

```
registry=https://registry.npmjs.org/

@ansonallard:registry=https://artifacts.ansonallard.com/api/packages/ansonallard/npm/
//artifacts.ansonallard.com/api/packages/ansonallard/npm/:_authToken=<PAT>
```

Where the `<PAT>` is your gitea PAT.

### Pulling Autogenerated Go Clients

Configure the following Go Env Vars:

```
GONOSUMDB=artifacts.ansonallard.com \
GOPROXY=https://<USER>:<PAT>@artifacts.ansonallard.com/api/packages/ansonallard/go,https://proxy.golang.org,direct \
go get -x artifacts.ansonallard.com/ansonallard/<Package>@<Version>
```

Where `<USER>` is your gitea user and `<PAT>` is your gitea user's PAT.
